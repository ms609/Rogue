<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Rogue">
<title>Detecting rogue taxa in Bayesian posterior tree sets • Rogue</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Detecting rogue taxa in Bayesian posterior tree sets">
<meta property="og:description" content="Rogue">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Rogue</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.1.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Bayesian.html">Detecting rogue taxa in Bayesian posterior tree sets</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ms609/Rogue/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Detecting rogue taxa in Bayesian posterior tree sets</h1>
                        <h4 data-toc-skip class="author">
<a href="https://orcid.org/0000-0001-5660-1727" class="external-link"><img src="https://info.orcid.org/wp-content/uploads/2020/12/orcid_16x16.gif" alt="ORCiD"></a>Martin R. Smith, Durham University</h4>
            
            <h4 data-toc-skip class="date">2023-01-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ms609/Rogue/blob/HEAD/vignettes/Bayesian.Rmd" class="external-link"><code>vignettes/Bayesian.Rmd</code></a></small>
      <div class="d-none name"><code>Bayesian.Rmd</code></div>
    </div>

    
    
<p>Detecting “rogue” taxa and removing them from summary trees can
produce consensus trees with a higher resolution, and can reveal strong
support for groupings that would otherwise be masked by the uncertain
position of rogues.</p>
<p>The raw output of Bayesian analysis requires a little processing
before rogue taxa can be identified and explored using the “Rogue” R
package.</p>
<p>The workflow presented here should be reasonably easy to adapt for
the output of any Bayesian phylogenetic analysis, but if you hit snags
or get stuck please let me know by <a href="https://github.com/ms609/Rogue/issues/new?title=Bayesian+vignette" class="external-link">filing
a GitHub issue</a> or by e-mail.</p>
<div class="section level2">
<h2 id="set-up">Set up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<p>Let’s start by loading the packages we’ll need:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ms609.github.io/TreeTools/" class="external-link">"TreeTools"</a></span><span class="op">)</span> <span class="co"># Read and plot trees</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/ms609/Rogue/" class="external-link">"Rogue"</a></span><span class="op">)</span> <span class="co"># Find rogue taxa</span></span></code></pre></div>
<p>We’ll work with some example data generated from a morphological
analysis of early brachiopods <span class="citation">(Sun et al.,
2018)</span> using <a href="https://nbisweden.github.io/MrBayes/" class="external-link">MrBayes</a> <span class="citation">(Hulsenbeck &amp; Ronquist, 2001)</span>. Our data
files are stored on <a href="https://github.com/ms609/hyoliths/tree/master/MrBayes" class="external-link">GitHub</a>.
Let’s load the results of run 1:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">online</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dataFolder</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/ms609/hyoliths/master/MrBayes/"</span></span>
<span>  <span class="va">run1.t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dataFolder</span>, <span class="st">"hyo.nex.run1.t"</span><span class="op">)</span></span>
<span>  <span class="co"># Reading 10k trees takes a second or two...</span></span>
<span>  <span class="va">run1Trees</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.nexus.html" class="external-link">read.nexus</a></span><span class="op">(</span><span class="va">run1.t</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">'ape'</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="st">"5.6.1"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Workaround for a bug in ape, hopefully fixed in v5.6.2</span></span>
<span>    <span class="va">run1Trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">run1Trees</span>, <span class="kw">function</span><span class="op">(</span><span class="va">tr</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">tr</span><span class="op">$</span><span class="va">tip.label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">run1Trees</span>, <span class="st">'TipLabel'</span><span class="op">)</span></span>
<span>      <span class="va">tr</span></span>
<span>    <span class="op">}</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">'multiPhylo'</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># If no internet connection, we can generate some example trees instead</span></span>
<span>  <span class="va">run1Trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">21</span>, <span class="kw">function</span><span class="op">(</span><span class="va">backbone</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/AddTip.html" class="external-link">AddTipEverywhere</a></span><span class="op">(</span><span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/as.phylo.html" class="external-link">as.phylo</a></span><span class="op">(</span><span class="fl">0</span>, nTip <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>, <span class="st">'ROGUE'</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">'multiPhylo'</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="select-trees-to-analyse">Select trees to analyse<a class="anchor" aria-label="anchor" href="#select-trees-to-analyse"></a>
</h2>
<p>Our tree file contains all trees generated. We typically want to
discard a proportion of trees as burn-in:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">burninFrac</span> <span class="op">&lt;-</span> <span class="fl">0.25</span></span>
<span><span class="va">nTrees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">run1Trees</span><span class="op">)</span></span>
<span><span class="va">trees</span> <span class="op">&lt;-</span> <span class="va">run1Trees</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">burninFrac</span> <span class="op">*</span> <span class="va">nTrees</span>, to <span class="op">=</span> <span class="va">nTrees</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>This is a large number of trees to analyse. We could save time for an
initial analysis by thinning our sample somewhat.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampleSize</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">trees</span> <span class="op">&lt;-</span> <span class="va">run1Trees</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">burninFrac</span> <span class="op">*</span> <span class="va">nTrees</span>, to <span class="op">=</span> <span class="va">nTrees</span>,</span>
<span>                       length.out <span class="op">=</span> <span class="va">sampleSize</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>For a full analysis, we ought to consider the output from the other
runs of our analysis, perhaps with</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>nRuns <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>allTrees <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_len</span>(nRuns), <span class="cf">function</span>(run) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  runTrees <span class="ot">&lt;-</span> ape<span class="sc">::</span><span class="fu">read.nexus</span>(<span class="fu">paste0</span>(dataFolder, <span class="st">'hyo.nex.run'</span>, run, .<span class="st">'t'</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  runTrees <span class="ot">&lt;-</span> runTrees[<span class="fu">seq</span>(<span class="at">from =</span> burninFrac <span class="sc">*</span> nTrees, <span class="at">to =</span> nTrees,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">length.out =</span> sampleSize <span class="sc">/</span> nRuns)]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">&lt;-</span> <span class="fu">structure</span>(<span class="fu">unlist</span>(allTrees, <span class="at">recursive =</span> <span class="cn">FALSE</span>), <span class="at">class =</span> <span class="st">'multiPhylo'</span>)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="initial-appraisal">Initial appraisal<a class="anchor" aria-label="anchor" href="#initial-appraisal"></a>
</h2>
<p>Let’s start by looking at the majority rule consensus tree. It can be
instructive to colour leaves by their instability; here we use the
<em>ad hoc</em> approach of <span class="citation">Smith
(2022)</span>.</p>
<p>First let’s define a function to plot a gradient legend:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plenary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/Consensus.html" class="external-link">Consensus</a></span><span class="op">(</span><span class="va">trees</span>, p <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">plenary</span>, tip.color <span class="op">=</span> <span class="fu"><a href="../reference/TipInstability.html">ColByStability</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ms609.github.io/TreeTools/reference/SpectrumLegend.html" class="external-link">SpectrumLegend</a></span><span class="op">(</span><span class="fl">0.06</span>, <span class="fl">0.06</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Stable"</span>, <span class="st">"Unstable"</span><span class="op">)</span>,</span>
<span>               palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">131</span>, <span class="st">'inferno'</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">101</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bayesian_files/figure-html/initial-view-1.png" width="768"></p>
<p>Some taxa stand out as having a less stable position on the tree than
others. Will removing those taxa reveal enough additional information
about the remaining taxa to compensate for the loss of information about
where those taxa plot?</p>
</div>
<div class="section level2">
<h2 id="detect-rogue-taxa">Detect rogue taxa<a class="anchor" aria-label="anchor" href="#detect-rogue-taxa"></a>
</h2>
<p>We have a few options for how we evaluate the negative impact of
retaining these rogue taxa in our consensus tree.</p>
<p><code><a href="../reference/RogueTaxa.html">QuickRogue()</a></code> uses the quick heuristic method of <span class="citation">Smith (2022)</span>; <code><a href="../reference/RogueTaxa.html">RogueTaxa()</a></code> supports
Smith’s slower heuristic, which might find a set of rogue taxa that
yield slightly more improvement to a consensus tree; it can also be
configured to employ the RogueNaRok approach <span class="citation">(Aberer, Krompass, &amp; Stamatakis, 2013)</span>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rogues</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RogueTaxa.html">QuickRogue</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Drop leaf <span style="color: #00BB00;">■■■■■■■■■■■■■■■■                </span>  49% | Leaf 15; 538/916 bits ETA:  1s</span></span></code></pre>
<pre><code><span><span class="co">## Drop leaf <span style="color: #00BB00;">■■■■■■■■■■■■■■■■■■■■■           </span>  68% | Leaf 23; 538/551 bits ETA:  1s</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rogues &lt;- RogueTaxa(trees) might do a better job, much more slowly</span></span>
<span><span class="va">rogues</span></span></code></pre></div>
<pre><code><span><span class="co">##   num taxNum                taxon rawImprovement       IC</span></span>
<span><span class="co">## 1   0   &lt;NA&gt;                 &lt;NA&gt;             NA 435.3517</span></span>
<span><span class="co">## 2   1     49          Paterimitra      68.263028 503.6148</span></span>
<span><span class="co">## 3   2     44              Micrina      13.384875 516.9996</span></span>
<span><span class="co">## 4   3     51 Siphonobolus_priscus       5.467555 522.4672</span></span>
<span><span class="co">## 5   4     53              Ussunia      15.200668 537.6679</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The first line reports the information content of the plenary tree</span></span>
<span><span class="va">rogueTaxa</span> <span class="op">&lt;-</span> <span class="va">rogues</span><span class="op">$</span><span class="va">taxon</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualize-results">Visualize results<a class="anchor" aria-label="anchor" href="#visualize-results"></a>
</h2>
<p>Let’s see how these taxa influence the majority rule consensus of our
results. Removing rogues may reveal information by producing reduced
consensus trees with a higher resolution, or with higher split support
values.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="co"># Remove plot margin</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Multi-panel plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span> <span class="co"># Smaller labels</span></span>
<span></span>
<span><span class="va">plenary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/Consensus.html" class="external-link">Consensus</a></span><span class="op">(</span><span class="va">trees</span>, p <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">reduced</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/ConsensusWithout.html" class="external-link">ConsensusWithout</a></span><span class="op">(</span><span class="va">trees</span>, <span class="va">rogueTaxa</span>, p <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">plenary</span>,</span>
<span>     tip.color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">plenary</span><span class="op">$</span><span class="va">tip.label</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">rogueTaxa</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ms609.github.io/TreeTools/reference/LabelSplits.html" class="external-link">LabelSplits</a></span><span class="op">(</span><span class="va">plenary</span>, <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/SplitFrequency.html" class="external-link">SplitFrequency</a></span><span class="op">(</span><span class="va">plenary</span>, <span class="va">trees</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">reduced</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ms609.github.io/TreeTools/reference/LabelSplits.html" class="external-link">LabelSplits</a></span><span class="op">(</span><span class="va">reduced</span>, <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/SplitFrequency.html" class="external-link">SplitFrequency</a></span><span class="op">(</span><span class="va">reduced</span>, <span class="va">trees</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bayesian_files/figure-html/trees-1.png" width="768"></p>
<p>We can also visualize the locations where our rogue taxa would plot
on the reduced consensus tree: the rogue occurs more frequently at the
brighter locations.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="va">whichTaxon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rogueTaxa</span><span class="op">)</span> <span class="co"># Select an illuminating taxon</span></span>
<span><span class="va">positions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ms609.github.io/TreeTools/reference/RoguePlot.html" class="external-link">RoguePlot</a></span><span class="op">(</span><span class="va">trees</span>, <span class="va">rogueTaxa</span><span class="op">[</span><span class="va">whichTaxon</span><span class="op">]</span>, p <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot a legend for the edge colours</span></span>
<span><span class="fu"><a href="https://ms609.github.io/TreeTools/reference/SpectrumLegend.html" class="external-link">SpectrumLegend</a></span><span class="op">(</span><span class="fl">0.06</span>, <span class="fl">0.06</span>,</span>
<span>               legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">positions</span><span class="op">$</span><span class="va">onEdge</span>, <span class="va">positions</span><span class="op">$</span><span class="va">atNode</span><span class="op">)</span>,</span>
<span>                              <span class="st">'trees'</span><span class="op">)</span>,</span>
<span>               palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">"fg"</span><span class="op">)</span>, <span class="st">"#009E73"</span><span class="op">)</span>,</span>
<span>                                           space <span class="op">=</span> <span class="st">"Lab"</span><span class="op">)</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Bayesian_files/figure-html/rogue-plot-trees-1.png" width="768"></p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-Aberer2013" class="csl-entry">
Aberer, A. J., Krompass, D., &amp; Stamatakis, A. (2013). Pruning rogue
taxa improves phylogenetic accuracy: An efficient algorithm and
webservice. <em>Systematic Biology</em>, <em>62</em>(1), 162–166. doi:<a href="https://doi.org/10.1093/sysbio/sys078" class="external-link">10.1093/sysbio/sys078</a>
</div>
<div id="ref-Hulsenbeck2001" class="csl-entry">
Hulsenbeck, J., &amp; Ronquist, F. (2001). MrBayes: Bayesian inference
of phylogeny. <em>Bioinformatics</em>, <em>17</em>, 754–755.
</div>
<div id="ref-SmithCons" class="csl-entry">
Smith, M. R. (2022). Using information theory to detect rogue taxa and
improve consensus trees. <em>Systematic Biology</em>, <em>71</em>(5),
986–1008. doi:<a href="https://doi.org/10.1093/sysbio/syab099" class="external-link">10.1093/sysbio/syab099</a>
</div>
<div id="ref-Sun2018" class="csl-entry">
Sun, H., Smith, M. R., Zeng, H., Zhao, F., Li, G., &amp; Zhu, M. (2018).
Hyoliths with pedicles illuminate the origin of the brachiopod body
plan. <em>Proceedings of the Royal Society B: Biological Sciences</em>,
<em>285</em>(1887), 20181780. doi:<a href="https://doi.org/10.1098/rspb.2018.1780" class="external-link">10.1098/rspb.2018.1780</a>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://smithlabdurham.github.io/" class="external-link">Martin R. Smith</a>, Andre J. Aberer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
